# üîß –ü–†–û–°–¢–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï PUSH-–£–í–ï–î–û–ú–õ–ï–ù–ò–ô

## üéØ –ü—Ä–æ–±–ª–µ–º–∞
–†–µ–∞–ª—å–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞.

## ‚úÖ –ü–†–û–°–¢–û–ï –†–ï–®–ï–ù–ò–ï

### 1. –í—ã–ø–æ–ª–Ω–∏ SQL –≤ Supabase
–ó–∞–π–¥–∏ –≤ Supabase Dashboard ‚Üí SQL Editor –∏ –≤—ã–ø–æ–ª–Ω–∏:

```sql
-- –¢–µ—Å—Ç–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
CREATE OR REPLACE FUNCTION test_push_for_user(user_id_param UUID)
RETURNS TEXT
LANGUAGE plpgsql
AS $$
DECLARE
  user_token TEXT;
BEGIN
  SELECT token INTO user_token FROM push_tokens WHERE user_id = user_id_param LIMIT 1;
  
  IF user_token IS NULL THEN
    RETURN '–¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω';
  END IF;
  
  RETURN '–¢–æ–∫–µ–Ω –Ω–∞–π–¥–µ–Ω: ' || LEFT(user_token, 20) || '...';
END;
$$;
```

### 2. –ü—Ä–æ–≤–µ—Ä—å —Ç–æ–∫–µ–Ω –≤ –±–∞–∑–µ
```sql
-- –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ —Ç–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω
SELECT * FROM push_tokens WHERE user_id = '29f5dae6-e50b-4790-8264-5c9af05c5065';

-- –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω–∞ –Ω–µ—Ç, –ø—Ä–æ–≤–µ—Ä—å —Ç–∞–±–ª–∏—Ü—É
SELECT * FROM push_tokens ORDER BY created_at DESC LIMIT 5;
```

### 3. –¢–µ—Å—Ç–∏—Ä—É–π —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤—Ä—É—á–Ω—É—é

–í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω–∏:

```javascript
// –ü–æ–ª—É—á–∏ —Ç–æ–∫–µ–Ω –∏–∑ –ª–æ–≥–æ–≤
const token = 'e3fJM0FVQjeiUgz6cdgV9X:APA91bH5Exr-NQP4zd1Bb9f-OssmwdlMZRTu7zYNrKjHYkRyBb-Z2WQqscZZagCqbj5o9QYpLpA36OmaAShXTNkMY_4ExztfFpUqyRMkfSy5jwkU0eh7zAc';

// –û—Ç–ø—Ä–∞–≤—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–∞–ø—Ä—è–º—É—é
fetch('https://fcm.googleapis.com/fcm/send', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': 'key=AIzaSyAH6yQWf32M41oLhscegD8HTvrGlbjgPRU'
  },
  body: JSON.stringify({
    to: token,
    notification: {
      title: 'üß™ –¢–µ—Å—Ç –∏–∑ –∫–æ–Ω—Å–æ–ª–∏',
      body: '–ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä—è–º—É—é –æ—Ç–ø—Ä–∞–≤–∫—É',
      icon: '/water.png'
    },
    data: {
      test: 'true'
    }
  })
}).then(r => r.json()).then(console.log);
```

### 4. –ï—Å–ª–∏ —Ç–µ—Å—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç - –ø—Ä–æ–±–ª–µ–º–∞ –≤ –∫–æ–¥–µ

–¢–æ–≥–¥–∞ –ø—Ä–æ–±–ª–µ–º–∞ –≤ —Ç–æ–º, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è `sendOrderStatusNotification` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è.

–î–æ–±–∞–≤—å –ª–æ–≥–∏ –≤ `useAcceptOrder`:

```javascript
onSuccess: async (order) => {
  console.log('üéØ –ó–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ:', order);
  queryClient.invalidateQueries({ queryKey: ['orders'] })
  
  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
  await sendOrderStatusNotification(order.user_id, {
    title: 'üöö –°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –∏–∑–º–µ–Ω–µ–Ω',
    body: '–í–∞—à –∑–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç –≤–æ–¥–∏—Ç–µ–ª–µ–º',
    orderId: order.id
  })
  
  console.log('‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ');
},
```

## üöÄ –ë–´–°–¢–†–´–ô –¢–ï–°–¢

1. **–°–æ–∑–¥–∞–π –∑–∞–∫–∞–∑** –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
2. **–°–∫–æ–ø–∏—Ä—É–π —Ç–æ–∫–µ–Ω** –∏–∑ –ª–æ–≥–æ–≤ –∫–æ–Ω—Å–æ–ª–∏
3. **–í—ã–ø–æ–ª–Ω–∏ —Ç–µ—Å—Ç** –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (–∫–æ–¥ –≤—ã—à–µ)
4. **–ü—Ä–æ–≤–µ—Ä—å** - –¥–æ–ª–∂–Ω–æ –ø—Ä–∏–π—Ç–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

–ï—Å–ª–∏ —Ç–µ—Å—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç, –∑–Ω–∞—á–∏—Ç –ø—Ä–æ–±–ª–µ–º–∞ –≤ –ª–æ–≥–∏–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –∞ –Ω–µ –≤ Firebase.

## üìä –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ –ø—Ä–∏ –ø—Ä–∏–Ω—è—Ç–∏–∏ –∑–∞–∫–∞–∑–∞:
- ‚úÖ `üéØ –ó–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ`
- ‚úÖ `üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é`
- ‚úÖ `üì± –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ —Ç–æ–∫–µ–Ω`
- ‚úÖ `‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ`

–ï—Å–ª–∏ —ç—Ç–∏—Ö –ª–æ–≥–æ–≤ –Ω–µ—Ç - —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è.
–ï—Å–ª–∏ –ª–æ–≥–∏ –µ—Å—Ç—å, –Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç - –ø—Ä–æ–±–ª–µ–º–∞ –≤ Firebase API.

---

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –û–ø—Ä–µ–¥–µ–ª–∏–º —Ç–æ—á–Ω–æ –≥–¥–µ –ø—Ä–æ–±–ª–µ–º–∞ - –≤ –∫–æ–¥–µ –∏–ª–∏ –≤ Firebase.