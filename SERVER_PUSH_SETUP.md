# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## üéØ –ü—Ä–æ–±–ª–µ–º–∞
–°–µ–π—á–∞—Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–æ. –î–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ —Ñ–æ–Ω–µ –Ω—É–∂–µ–Ω —Å–µ—Ä–≤–µ—Ä.

## üîß –†–µ—à–µ–Ω–∏–µ

### 1. **–°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É –¥–ª—è —Ç–æ–∫–µ–Ω–æ–≤ –≤ Supabase**
```sql
-- –í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ Supabase SQL Editor
-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞: push-tokens-table.sql
```

### 2. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å Firebase Admin SDK**

#### –í–∞—Ä–∏–∞–Ω—Ç A: Firebase Functions (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Firebase CLI
npm install -g firebase-tools

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
firebase login
firebase init functions

# –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π
firebase deploy --only functions
```

#### –í–∞—Ä–∏–∞–Ω—Ç B: –°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
npm install express cors firebase-admin

# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
node push-server.js
```

### 3. **–ü–æ–ª—É—á–∏—Ç—å Service Account Key**
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ [Firebase Console](https://console.firebase.google.com/)
2. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ ‚Üí –°–µ—Ä–≤–∏—Å–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã
3. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∑–∞–∫—Ä—ã—Ç—ã–π –∫–ª—é—á
4. –°–∫–∞—á–∞—Ç—å `service-account-key.json`

### 4. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π**

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞–ø—Ä–æ—Å–∞:
```javascript
// –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
POST /send-notification
{
  "token": "push-token-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",
  "title": "–°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –∏–∑–º–µ–Ω–µ–Ω",
  "body": "–í–∞—à –∑–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç –≤–æ–¥–∏—Ç–µ–ª–µ–º",
  "data": {
    "orderId": "123",
    "route": "/user/orders"
  }
}

// –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–æ–¥–∏—Ç–µ–ª—è–º
POST /send-to-drivers
{
  "tokens": ["token1", "token2", "token3"],
  "title": "–ù–æ–≤—ã–π –∑–∞–∫–∞–∑!",
  "body": "–î–æ—Å—Ç–∞–≤–∫–∞ –≤–æ–¥—ã - —É–ª. –õ–µ–Ω–∏–Ω–∞ 15",
  "data": {
    "orderId": "123",
    "route": "/driver/dashboard"
  }
}
```

## üöÄ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º

### 1. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤**
–ü—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å push-—Ç–æ–∫–µ–Ω –≤ —Ç–∞–±–ª–∏—Ü–µ `push_tokens`:
```javascript
// –ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞
await supabase
  .from('push_tokens')
  .upsert({
    user_id: user.id, // –∏–ª–∏ driver_id –¥–ª—è –≤–æ–¥–∏—Ç–µ–ª–µ–π
    token: pushToken,
    device_type: 'android'
  })
```

### 2. **–û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–æ–≤**
```javascript
// –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞
const { data: tokens } = await supabase
  .from('push_tokens')
  .select('token')
  .eq('user_id', order.user_id)

// –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ API
await fetch('https://your-server.com/send-notification', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    token: tokens[0]?.token,
    title: '–°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –∏–∑–º–µ–Ω–µ–Ω',
    body: '–í–∞—à –∑–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç –≤–æ–¥–∏—Ç–µ–ª–µ–º'
  })
})
```

## üì± –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. **–ß–µ—Ä–µ–∑ Firebase Console**
1. Firebase Console ‚Üí Cloud Messaging
2. –°–æ–∑–¥–∞—Ç—å –∫–∞–º–ø–∞–Ω–∏—é
3. –£–∫–∞–∑–∞—Ç—å —Ç–æ–∫–µ–Ω —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
4. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

### 2. **–ß–µ—Ä–µ–∑ API**
```bash
curl -X POST http://localhost:3001/send-notification \
  -H "Content-Type: application/json" \
  -d '{
    "token": "–≤–∞—à-push-token",
    "title": "–¢–µ—Å—Ç",
    "body": "–¢–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ"
  }'
```

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç
–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –±—É–¥—É—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç—å:
- ‚úÖ –ö–æ–≥–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–æ
- ‚úÖ –ö–æ–≥–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ —Ñ–æ–Ω–µ  
- ‚úÖ –ö–æ–≥–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ
- ‚úÖ –°–æ –∑–≤—É–∫–æ–º –∏ –≤–∏–±—Ä–∞—Ü–∏–µ–π
- ‚úÖ –í —à—Ç–æ—Ä–∫–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π Android